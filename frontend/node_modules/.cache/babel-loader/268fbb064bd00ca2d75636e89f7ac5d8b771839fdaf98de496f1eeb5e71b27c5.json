{"ast":null,"code":"// import React, { useState } from \"react\";\n// import { useNavigate } from \"react-router-dom\";\n// import authService from \"../../services/authService\";\n\n// const Login = () => {\n//   const navigate = useNavigate();\n//   const [form, setForm] = useState({\n//     email: \"\",\n//     password: \"\",\n//   });\n\n//   const handleChange = (e) => {\n//     setForm({ ...form, [e.target.name]: e.target.value });\n//   };\n\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     try {\n//       const res = await authService.login(form);\n//       console.log(\"‚úÖ LOGIN RESULT:\", res.data);\n\n//       const loginData = res.data;\n\n//       // ‚úÖ S·ª¨A: Server tr·∫£ v·ªÅ 'token' ch·ª© kh√¥ng ph·∫£i 'jwt-token'\n//       const token = loginData.token || loginData['jwt-token'];\n\n//       if (!token) {\n//         console.error(\"‚ùå No token found in response:\", loginData);\n//         throw new Error(\"No token received from server\");\n//       }\n\n//       console.log(\"üîê Token received:\", token.substring(0, 50) + \"...\");\n\n//       // ‚úÖ L∆ØU TOKEN\n//       localStorage.setItem(\"token\", token);\n//       console.log(\"üíæ Token saved to localStorage\");\n\n//       // ‚úÖ GI·∫¢I M√É TOKEN ƒê·ªÇ L·∫§Y USER ID\n//       let realUserId = null;\n//       let userEmail = form.email;\n\n//       try {\n//         // Gi·∫£i m√£ payload t·ª´ JWT token\n//         const payload = JSON.parse(atob(token.split('.')[1]));\n//         console.log(\"üîì Decoded token payload:\", payload);\n\n//         // L·∫•y user ID t·ª´ token payload\n//         realUserId = payload.sub || payload.userId || payload.user_id;\n//         userEmail = payload.email || userEmail;\n\n//         console.log(\"‚úÖ User ID from token:\", realUserId);\n//         console.log(\"‚úÖ User email from token:\", userEmail);\n//       } catch (decodeError) {\n//         console.warn(\"‚ö†Ô∏è Could not decode token:\", decodeError);\n//       }\n\n//       // ‚úÖ TH·ª¨ L·∫§Y USER ID T·ª™ API /auth/me N·∫æU KH√îNG C√ì T·ª™ TOKEN\n//       if (!realUserId) {\n//         console.log(\"üîç No user ID from token, calling /auth/me...\");\n//         try {\n//           const userInfoResponse = await fetch('http://localhost:8080/api/auth/me', {\n//             method: 'GET',\n//             headers: {\n//               'Authorization': `Bearer ${token}`,\n//               'Content-Type': 'application/json'\n//             }\n//           });\n\n//           if (userInfoResponse.ok) {\n//             const userInfo = await userInfoResponse.json();\n//             realUserId = userInfo.userId || userInfo.user_id;\n//             console.log(\"‚úÖ User ID from /auth/me:\", realUserId);\n//           } else {\n//             console.warn(\"‚ö†Ô∏è /auth/me failed, status:\", userInfoResponse.status);\n//           }\n//         } catch (meError) {\n//           console.warn(\"‚ö†Ô∏è /auth/me endpoint error:\", meError);\n//         }\n//       }\n\n//       // ‚úÖ N·∫æU V·∫™N KH√îNG C√ì USER ID, T·∫†O TEMP ID\n//       if (!realUserId) {\n//         console.warn(\"‚ö†Ô∏è No real user ID found, creating temporary ID\");\n//         realUserId = `temp_${Date.now()}`;\n//       }\n\n//       // ‚úÖ L∆ØU USER DATA\n//       const userToStore = {\n//         userId: realUserId,\n//         email: userEmail,\n//         first_name: loginData.first_name || loginData.firstName || \"\",\n//         last_name: loginData.last_name || loginData.lastName || \"\"\n//       };\n\n//       localStorage.setItem(\"user\", JSON.stringify(userToStore));\n//       console.log(\"üíæ User data saved:\", userToStore);\n\n//       // ‚úÖ KI·ªÇM TRA L·∫†I\n//       const savedToken = localStorage.getItem(\"token\");\n//       const savedUser = JSON.parse(localStorage.getItem(\"user\"));\n\n//       console.log(\"üîç FINAL AUTH CHECK:\", {\n//         token: savedToken ? `EXISTS (${savedToken.length} chars)` : \"MISSING\",\n//         user: savedUser ? `EXISTS (ID: ${savedUser.userId})` : \"MISSING\"\n//       });\n\n//       alert(\"‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!\");\n\n//       // ‚úÖ CHUY·ªÇN TRANG\n//       setTimeout(() => {\n//         window.location.href = \"/\";\n//       }, 500);\n\n//     } catch (err) {\n//       console.error(\"‚ùå LOGIN ERROR:\", err);\n//       localStorage.clear();\n//       alert(\"‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: \" + (err.response?.data?.message || err.message));\n//     }\n//   };\n\n//   return (\n//     <div className=\"card mx-auto\" style={{ maxWidth: \"380px\", marginTop: \"100px\" }}>\n//       <div className=\"card-body\">\n//         <h4 className=\"card-title mb-4\">Sign in</h4>\n\n//         <form onSubmit={handleSubmit}>\n//           <div className=\"form-group\">\n//             <input\n//               name=\"email\"\n//               className=\"form-control\"\n//               placeholder=\"Email\"\n//               type=\"email\"\n//               value={form.email}\n//               onChange={handleChange}\n//               required\n//             />\n//           </div>\n\n//           <div className=\"form-group\">\n//             <input\n//               name=\"password\"\n//               className=\"form-control\"\n//               placeholder=\"Password\"\n//               type=\"password\"\n//               value={form.password}\n//               onChange={handleChange}\n//               required\n//             />\n//           </div>\n\n//           <button type=\"submit\" className=\"btn btn-primary btn-block\">\n//             Login\n//           </button>\n//         </form>\n//       </div>\n//     </div>\n//   );\n// };\n\n// export default Login;","map":{"version":3,"names":[],"sources":["D:/JVA/frontend/src/pages/auth/Login.js"],"sourcesContent":["// import React, { useState } from \"react\";\n// import { useNavigate } from \"react-router-dom\";\n// import authService from \"../../services/authService\";\n\n// const Login = () => {\n//   const navigate = useNavigate();\n//   const [form, setForm] = useState({\n//     email: \"\",\n//     password: \"\",\n//   });\n\n//   const handleChange = (e) => {\n//     setForm({ ...form, [e.target.name]: e.target.value });\n//   };\n\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     try {\n//       const res = await authService.login(form);\n//       console.log(\"‚úÖ LOGIN RESULT:\", res.data);\n\n//       const loginData = res.data;\n      \n//       // ‚úÖ S·ª¨A: Server tr·∫£ v·ªÅ 'token' ch·ª© kh√¥ng ph·∫£i 'jwt-token'\n//       const token = loginData.token || loginData['jwt-token'];\n      \n//       if (!token) {\n//         console.error(\"‚ùå No token found in response:\", loginData);\n//         throw new Error(\"No token received from server\");\n//       }\n\n//       console.log(\"üîê Token received:\", token.substring(0, 50) + \"...\");\n\n//       // ‚úÖ L∆ØU TOKEN\n//       localStorage.setItem(\"token\", token);\n//       console.log(\"üíæ Token saved to localStorage\");\n\n//       // ‚úÖ GI·∫¢I M√É TOKEN ƒê·ªÇ L·∫§Y USER ID\n//       let realUserId = null;\n//       let userEmail = form.email;\n\n//       try {\n//         // Gi·∫£i m√£ payload t·ª´ JWT token\n//         const payload = JSON.parse(atob(token.split('.')[1]));\n//         console.log(\"üîì Decoded token payload:\", payload);\n        \n//         // L·∫•y user ID t·ª´ token payload\n//         realUserId = payload.sub || payload.userId || payload.user_id;\n//         userEmail = payload.email || userEmail;\n        \n//         console.log(\"‚úÖ User ID from token:\", realUserId);\n//         console.log(\"‚úÖ User email from token:\", userEmail);\n//       } catch (decodeError) {\n//         console.warn(\"‚ö†Ô∏è Could not decode token:\", decodeError);\n//       }\n\n//       // ‚úÖ TH·ª¨ L·∫§Y USER ID T·ª™ API /auth/me N·∫æU KH√îNG C√ì T·ª™ TOKEN\n//       if (!realUserId) {\n//         console.log(\"üîç No user ID from token, calling /auth/me...\");\n//         try {\n//           const userInfoResponse = await fetch('http://localhost:8080/api/auth/me', {\n//             method: 'GET',\n//             headers: {\n//               'Authorization': `Bearer ${token}`,\n//               'Content-Type': 'application/json'\n//             }\n//           });\n          \n//           if (userInfoResponse.ok) {\n//             const userInfo = await userInfoResponse.json();\n//             realUserId = userInfo.userId || userInfo.user_id;\n//             console.log(\"‚úÖ User ID from /auth/me:\", realUserId);\n//           } else {\n//             console.warn(\"‚ö†Ô∏è /auth/me failed, status:\", userInfoResponse.status);\n//           }\n//         } catch (meError) {\n//           console.warn(\"‚ö†Ô∏è /auth/me endpoint error:\", meError);\n//         }\n//       }\n\n//       // ‚úÖ N·∫æU V·∫™N KH√îNG C√ì USER ID, T·∫†O TEMP ID\n//       if (!realUserId) {\n//         console.warn(\"‚ö†Ô∏è No real user ID found, creating temporary ID\");\n//         realUserId = `temp_${Date.now()}`;\n//       }\n\n//       // ‚úÖ L∆ØU USER DATA\n//       const userToStore = {\n//         userId: realUserId,\n//         email: userEmail,\n//         first_name: loginData.first_name || loginData.firstName || \"\",\n//         last_name: loginData.last_name || loginData.lastName || \"\"\n//       };\n\n//       localStorage.setItem(\"user\", JSON.stringify(userToStore));\n//       console.log(\"üíæ User data saved:\", userToStore);\n\n//       // ‚úÖ KI·ªÇM TRA L·∫†I\n//       const savedToken = localStorage.getItem(\"token\");\n//       const savedUser = JSON.parse(localStorage.getItem(\"user\"));\n      \n//       console.log(\"üîç FINAL AUTH CHECK:\", {\n//         token: savedToken ? `EXISTS (${savedToken.length} chars)` : \"MISSING\",\n//         user: savedUser ? `EXISTS (ID: ${savedUser.userId})` : \"MISSING\"\n//       });\n\n//       alert(\"‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!\");\n      \n//       // ‚úÖ CHUY·ªÇN TRANG\n//       setTimeout(() => {\n//         window.location.href = \"/\";\n//       }, 500);\n      \n//     } catch (err) {\n//       console.error(\"‚ùå LOGIN ERROR:\", err);\n//       localStorage.clear();\n//       alert(\"‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: \" + (err.response?.data?.message || err.message));\n//     }\n//   };\n\n//   return (\n//     <div className=\"card mx-auto\" style={{ maxWidth: \"380px\", marginTop: \"100px\" }}>\n//       <div className=\"card-body\">\n//         <h4 className=\"card-title mb-4\">Sign in</h4>\n\n//         <form onSubmit={handleSubmit}>\n//           <div className=\"form-group\">\n//             <input\n//               name=\"email\"\n//               className=\"form-control\"\n//               placeholder=\"Email\"\n//               type=\"email\"\n//               value={form.email}\n//               onChange={handleChange}\n//               required\n//             />\n//           </div>\n\n//           <div className=\"form-group\">\n//             <input\n//               name=\"password\"\n//               className=\"form-control\"\n//               placeholder=\"Password\"\n//               type=\"password\"\n//               value={form.password}\n//               onChange={handleChange}\n//               required\n//             />\n//           </div>\n\n//           <button type=\"submit\" className=\"btn btn-primary btn-block\">\n//             Login\n//           </button>\n//         </form>\n//       </div>\n//     </div>\n//   );\n// };\n\n// export default Login;"],"mappings":"AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}