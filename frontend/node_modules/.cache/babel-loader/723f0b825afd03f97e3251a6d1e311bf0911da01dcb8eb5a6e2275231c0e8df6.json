{"ast":null,"code":"import api from './api';\nconst cartService = {\n  // ðŸŸ¢ 1. Láº¥y nhanh Cart ID tá»« LocalStorage (Giá»‘ng logic Mobile)\n  getCartId: () => {\n    try {\n      var _user$cart;\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      // Thá»­ láº¥y tá»« object user hoáº·c tá»« object cart riÃªng biá»‡t\n      return (user === null || user === void 0 ? void 0 : user.cartId) || (user === null || user === void 0 ? void 0 : (_user$cart = user.cart) === null || _user$cart === void 0 ? void 0 : _user$cart.cartId) || JSON.parse(localStorage.getItem('cart') || '{}').cartId || null;\n    } catch (e) {\n      return null;\n    }\n  },\n  // ðŸŸ¢ 2. Láº¥y giá» hÃ ng chi tiáº¿t tá»« Server\n  getActiveCart: async email => {\n    try {\n      // Endpoint láº¥y danh sÃ¡ch carts cá»§a user\n      const response = await api.get(`/public/users/${email}/carts`);\n      const carts = response.data;\n      // Tráº£ vá» giá» hÃ ng Ä‘áº§u tiÃªn (Active)\n      return Array.isArray(carts) ? carts[0] : carts;\n    } catch (error) {\n      console.error('âŒ Lá»—i láº¥y giá» hÃ ng:', error.response);\n      throw error;\n    }\n  },\n  // ðŸŸ¢ 3. ThÃªm sáº£n pháº©m (Logic Ä‘á»“ng bá»™ vá»›i Mobile)\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n\n      // Sau khi thÃªm, cáº­p nháº­t láº¡i dá»¯ liá»‡u local Ä‘á»ƒ Ä‘á»“ng bá»™ sá»‘ lÆ°á»£ng\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      if (user.email) {\n        await cartService.refreshCart(user.email);\n      }\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i thÃªm vÃ o giá»:', error);\n      throw error;\n    }\n  },\n  // ðŸŸ¢ 4. LÃ m má»›i dá»¯ liá»‡u trong LocalStorage\n  refreshCart: async email => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId; // GÄƒm ID vÃ o user Ä‘á»ƒ láº§n sau láº¥y nhanh hÆ¡n\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      return null;\n    }\n  },\n  formatPrice: price => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(price || 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","getCartId","_user$cart","user","JSON","parse","localStorage","getItem","cartId","cart","e","getActiveCart","email","response","get","carts","data","Array","isArray","error","console","addToCart","productId","quantity","post","refreshCart","setItem","stringify","formatPrice","price","Intl","NumberFormat","style","currency","format"],"sources":["E:/Java/DoAn/frontend/src/services/cartService.js"],"sourcesContent":["import api from './api';\n\nconst cartService = {\n  // ðŸŸ¢ 1. Láº¥y nhanh Cart ID tá»« LocalStorage (Giá»‘ng logic Mobile)\n  getCartId: () => {\n    try {\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      // Thá»­ láº¥y tá»« object user hoáº·c tá»« object cart riÃªng biá»‡t\n      return user?.cartId || user?.cart?.cartId || JSON.parse(localStorage.getItem('cart') || '{}').cartId || null;\n    } catch (e) {\n      return null;\n    }\n  },\n\n  // ðŸŸ¢ 2. Láº¥y giá» hÃ ng chi tiáº¿t tá»« Server\n  getActiveCart: async (email) => {\n    try {\n      // Endpoint láº¥y danh sÃ¡ch carts cá»§a user\n      const response = await api.get(`/public/users/${email}/carts`);\n      const carts = response.data;\n      // Tráº£ vá» giá» hÃ ng Ä‘áº§u tiÃªn (Active)\n      return Array.isArray(carts) ? carts[0] : carts;\n    } catch (error) {\n      console.error('âŒ Lá»—i láº¥y giá» hÃ ng:', error.response);\n      throw error;\n    }\n  },\n\n  // ðŸŸ¢ 3. ThÃªm sáº£n pháº©m (Logic Ä‘á»“ng bá»™ vá»›i Mobile)\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      \n      // Sau khi thÃªm, cáº­p nháº­t láº¡i dá»¯ liá»‡u local Ä‘á»ƒ Ä‘á»“ng bá»™ sá»‘ lÆ°á»£ng\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      if (user.email) {\n        await cartService.refreshCart(user.email);\n      }\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i thÃªm vÃ o giá»:', error);\n      throw error;\n    }\n  },\n\n  // ðŸŸ¢ 4. LÃ m má»›i dá»¯ liá»‡u trong LocalStorage\n  refreshCart: async (email) => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId; // GÄƒm ID vÃ o user Ä‘á»ƒ láº§n sau láº¥y nhanh hÆ¡n\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      return null;\n    }\n  },\n\n  formatPrice: (price) => {\n    return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price || 0);\n  }\n};\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}