{"ast":null,"code":"// services/cartService.js\nimport api from './api';\nconst cartService = {\n  // Tạo giỏ hàng mới\n  createCart: async email => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo giỏ hàng:', error);\n      throw error;\n    }\n  },\n  // Lấy giỏ hàng active\n  getActiveCart: async email => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi lấy giỏ hàng:', error);\n      throw error;\n    }\n  },\n  // Thêm sản phẩm vào giỏ hàng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi thêm vào giỏ hàng:', error);\n      throw error;\n    }\n  },\n  // Cập nhật số lượng\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi cập nhật số lượng:', error);\n      throw error;\n    }\n  },\n  // Xóa sản phẩm\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi xóa sản phẩm:', error);\n      throw error;\n    }\n  },\n  // Tạo đơn hàng\n  createOrder: async (email, cartId, paymentMethod) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts/${cartId}/payments/${paymentMethod}/order`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo đơn hàng:', error);\n      throw error;\n    }\n  },\n  // Tính tổng tiền - FIXED\n  calculateTotal: cartItems => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      // Ưu tiên specialPrice nếu có, nếu không thì dùng price\n      const price = item.specialPrice !== undefined && item.specialPrice !== null ? item.specialPrice : item.price || 0;\n      const quantity = item.quantity || 1;\n      return total + price * quantity;\n    }, 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","createCart","email","response","post","data","error","console","getActiveCart","get","addToCart","cartId","productId","quantity","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","calculateTotal","cartItems","length","reduce","total","item","price","specialPrice","undefined"],"sources":["D:/JVA/frontend/src/services/cartService.js"],"sourcesContent":["// services/cartService.js\nimport api from './api';\n\nconst cartService = {\n  // Tạo giỏ hàng mới\n  createCart: async (email) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo giỏ hàng:', error);\n      throw error;\n    }\n  },\n\n  // Lấy giỏ hàng active\n  getActiveCart: async (email) => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi lấy giỏ hàng:', error);\n      throw error;\n    }\n  },\n\n  // Thêm sản phẩm vào giỏ hàng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi thêm vào giỏ hàng:', error);\n      throw error;\n    }\n  },\n\n  // Cập nhật số lượng\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi cập nhật số lượng:', error);\n      throw error;\n    }\n  },\n\n  // Xóa sản phẩm\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi xóa sản phẩm:', error);\n      throw error;\n    }\n  },\n\n  // Tạo đơn hàng\n  createOrder: async (email, cartId, paymentMethod) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts/${cartId}/payments/${paymentMethod}/order`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo đơn hàng:', error);\n      throw error;\n    }\n  },\n  \n\n // Tính tổng tiền - FIXED\n  calculateTotal: (cartItems) => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      // Ưu tiên specialPrice nếu có, nếu không thì dùng price\n      const price = item.specialPrice !== undefined && item.specialPrice !== null \n        ? item.specialPrice \n        : item.price || 0;\n      const quantity = item.quantity || 1;\n      return total + (price * quantity);\n    }, 0);\n  }\n}\n\n\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}