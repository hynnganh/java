{"ast":null,"code":"var _jsxFileName = \"E:\\\\Java\\\\DoAn\\\\frontend\\\\src\\\\pages\\\\product\\\\ProductDetail.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useParams, Link, useNavigate } from \"react-router-dom\";\nimport productService from \"../../services/productService\";\nimport cartService from \"../../services/cartService\";\nimport Swal from \"sweetalert2\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst IMAGE_BASE_URL = \"http://localhost:8080/api/public/products/image\";\nconst ProductDetail = () => {\n  _s();\n  const {\n    productId\n  } = useParams();\n  const navigate = useNavigate();\n  const [product, setProduct] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [addingToCart, setAddingToCart] = useState(false);\n  useEffect(() => {\n    const fetchProduct = async () => {\n      try {\n        setLoading(true);\n        const data = await productService.getProductById(productId);\n        setProduct(data);\n      } catch (err) {\n        Swal.fire(\"Lỗi\", \"Không thể tải sản phẩm\", \"error\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchProduct();\n  }, [productId]);\n  const handleAddToCart = async () => {\n    const user = JSON.parse(localStorage.getItem('user'));\n    const token = localStorage.getItem('token');\n    if (!user || !token) {\n      Swal.fire({\n        icon: 'info',\n        title: 'Xin mời đăng nhập',\n        text: 'Bạn cần đăng nhập để mua hàng!'\n      });\n      navigate('/login');\n      return;\n    }\n    try {\n      setAddingToCart(true);\n\n      // 1. Lấy ID giỏ hàng (Ưu tiên lấy từ LocalStorage để nhanh và tránh 401)\n      let cartId = cartService.getCartId();\n\n      // 2. Nếu máy chưa lưu ID, gọi API lấy từ Server\n      if (!cartId) {\n        const cartData = await cartService.getActiveCart(user.email);\n        cartId = cartData === null || cartData === void 0 ? void 0 : cartData.cartId;\n      }\n      if (!cartId) throw new Error(\"Chưa khởi tạo giỏ hàng\");\n\n      // 3. Gọi lệnh thêm vào giỏ\n      await cartService.addToCart(cartId, productId, 1);\n\n      // 4. Thành công\n      Swal.fire({\n        icon: 'success',\n        title: 'Thành công',\n        text: 'Đã thêm vào giỏ hàng!',\n        timer: 1500,\n        showConfirmButton: false\n      });\n\n      // Bắn event để Header cập nhật số lượng badge\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n    } catch (error) {\n      var _error$response;\n      console.error(\"Lỗi:\", error);\n      const status = (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status;\n      if (status === 401) {\n        Swal.fire(\"Hết hạn\", \"Vui lòng đăng nhập lại\", \"error\").then(() => navigate('/login'));\n      } else {\n        Swal.fire(\"Lỗi\", \"Không thể thêm vào giỏ hàng\", \"error\");\n      }\n    } finally {\n      setAddingToCart(false);\n    }\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center mt-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"spinner-border\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 57\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 23\n  }, this);\n  if (!product) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container mt-5\",\n    children: \"S\\u1EA3n ph\\u1EA9m kh\\xF4ng t\\u1ED3n t\\u1EA1i.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 24\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container mt-5 mb-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-6\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: `${IMAGE_BASE_URL}/${product.image}`,\n          className: \"img-fluid rounded shadow-sm\",\n          alt: product.productName,\n          style: {\n            maxHeight: '500px',\n            objectFit: 'contain',\n            width: '100%'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"fw-bold\",\n          children: product.productName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-danger mt-3\",\n          children: product.specialPrice ? cartService.formatPrice(product.specialPrice) : cartService.formatPrice(product.price)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-4 text-muted\",\n          children: product.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-5\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-warning btn-lg px-5 fw-bold text-white\",\n            onClick: handleAddToCart,\n            disabled: addingToCart || product.quantity <= 0,\n            children: addingToCart ? 'ĐANG THÊM...' : 'THÊM VÀO GIỎ'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n};\n_s(ProductDetail, \"4W9Ky4PjyhAMfpDnYUL63I0cvB4=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = ProductDetail;\nexport default ProductDetail;\nvar _c;\n$RefreshReg$(_c, \"ProductDetail\");","map":{"version":3,"names":["React","useEffect","useState","useParams","Link","useNavigate","productService","cartService","Swal","jsxDEV","_jsxDEV","IMAGE_BASE_URL","ProductDetail","_s","productId","navigate","product","setProduct","loading","setLoading","addingToCart","setAddingToCart","fetchProduct","data","getProductById","err","fire","handleAddToCart","user","JSON","parse","localStorage","getItem","token","icon","title","text","cartId","getCartId","cartData","getActiveCart","email","Error","addToCart","timer","showConfirmButton","window","dispatchEvent","Event","error","_error$response","console","status","response","then","className","children","fileName","_jsxFileName","lineNumber","columnNumber","src","image","alt","productName","style","maxHeight","objectFit","width","specialPrice","formatPrice","price","description","onClick","disabled","quantity","_c","$RefreshReg$"],"sources":["E:/Java/DoAn/frontend/src/pages/product/ProductDetail.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams, Link, useNavigate } from \"react-router-dom\";\nimport productService from \"../../services/productService\";\nimport cartService from \"../../services/cartService\";\nimport Swal from \"sweetalert2\";\n\nconst IMAGE_BASE_URL = \"http://localhost:8080/api/public/products/image\";\n\nconst ProductDetail = () => {\n  const { productId } = useParams();\n  const navigate = useNavigate();\n  const [product, setProduct] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [addingToCart, setAddingToCart] = useState(false);\n\n  useEffect(() => {\n    const fetchProduct = async () => {\n      try {\n        setLoading(true);\n        const data = await productService.getProductById(productId);\n        setProduct(data);\n      } catch (err) {\n        Swal.fire(\"Lỗi\", \"Không thể tải sản phẩm\", \"error\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchProduct();\n  }, [productId]);\n\n  const handleAddToCart = async () => {\n    const user = JSON.parse(localStorage.getItem('user'));\n    const token = localStorage.getItem('token');\n\n    if (!user || !token) {\n      Swal.fire({ icon: 'info', title: 'Xin mời đăng nhập', text: 'Bạn cần đăng nhập để mua hàng!' });\n      navigate('/login');\n      return;\n    }\n\n    try {\n      setAddingToCart(true);\n\n      // 1. Lấy ID giỏ hàng (Ưu tiên lấy từ LocalStorage để nhanh và tránh 401)\n      let cartId = cartService.getCartId();\n\n      // 2. Nếu máy chưa lưu ID, gọi API lấy từ Server\n      if (!cartId) {\n        const cartData = await cartService.getActiveCart(user.email);\n        cartId = cartData?.cartId;\n      }\n\n      if (!cartId) throw new Error(\"Chưa khởi tạo giỏ hàng\");\n\n      // 3. Gọi lệnh thêm vào giỏ\n      await cartService.addToCart(cartId, productId, 1);\n\n      // 4. Thành công\n      Swal.fire({ icon: 'success', title: 'Thành công', text: 'Đã thêm vào giỏ hàng!', timer: 1500, showConfirmButton: false });\n      \n      // Bắn event để Header cập nhật số lượng badge\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n\n    } catch (error) {\n      console.error(\"Lỗi:\", error);\n      const status = error.response?.status;\n      if (status === 401) {\n        Swal.fire(\"Hết hạn\", \"Vui lòng đăng nhập lại\", \"error\").then(() => navigate('/login'));\n      } else {\n        Swal.fire(\"Lỗi\", \"Không thể thêm vào giỏ hàng\", \"error\");\n      }\n    } finally {\n      setAddingToCart(false);\n    }\n  };\n\n  if (loading) return <div className=\"text-center mt-5\"><div className=\"spinner-border\"></div></div>;\n  if (!product) return <div className=\"container mt-5\">Sản phẩm không tồn tại.</div>;\n\n  return (\n    <div className=\"container mt-5 mb-5\">\n      <div className=\"row\">\n        <div className=\"col-md-6\">\n          <img \n            src={`${IMAGE_BASE_URL}/${product.image}`} \n            className=\"img-fluid rounded shadow-sm\" \n            alt={product.productName} \n            style={{ maxHeight: '500px', objectFit: 'contain', width: '100%' }}\n          />\n        </div>\n        <div className=\"col-md-6\">\n          <h2 className=\"fw-bold\">{product.productName}</h2>\n          <h3 className=\"text-danger mt-3\">\n            {product.specialPrice ? cartService.formatPrice(product.specialPrice) : cartService.formatPrice(product.price)}\n          </h3>\n          <p className=\"mt-4 text-muted\">{product.description}</p>\n          <div className=\"mt-5\">\n            <button \n              className=\"btn btn-warning btn-lg px-5 fw-bold text-white\"\n              onClick={handleAddToCart}\n              disabled={addingToCart || product.quantity <= 0}\n            >\n              {addingToCart ? 'ĐANG THÊM...' : 'THÊM VÀO GIỎ'}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProductDetail;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}