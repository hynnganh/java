{"ast":null,"code":"import api from './api';\nconst cartService = {\n  // ========== QUáº¢N LÃ GIá»Ž HÃ€NG (API) ==========\n\n  // Láº¥y giá» hÃ ng Ä‘ang hoáº¡t Ä‘á»™ng cá»§a ngÆ°á»i dÃ¹ng\n  getActiveCart: async email => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      if (response.data) {\n        cartService.updateCartInStorage(response.data); // Äá»“ng bá»™ LocalStorage\n      }\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi láº¥y giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n  // ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      // Refresh láº¡i dá»¯ liá»‡u tá»« server sau khi thÃªm thÃ nh cÃ´ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh chÃ­nh xÃ¡c\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi thÃªm vÃ o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n  // Cáº­p nháº­t sá»‘ lÆ°á»£ng sáº£n pháº©m\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi cáº­p nháº­t sá»‘ lÆ°á»£ng:', error);\n      throw error;\n    }\n  },\n  // XÃ³a má»™t sáº£n pháº©m khá»i giá» hÃ ng\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi xÃ³a sáº£n pháº©m:', error);\n      throw error;\n    }\n  },\n  // ========== QUáº¢N LÃ Äáº¶T HÃ€NG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts/${cartId}/place-order`, null, {\n        params: {\n          paymentMethod: paymentMethod,\n          shippingAddress: shippingAddress\n        }\n      });\n\n      // Äáº¶C BIá»†T: Sau khi Ä‘áº·t hÃ ng thÃ nh cÃ´ng, giá» hÃ ng trÃªn server thÆ°á»ng sáº½ bá»‹ xÃ³a/Ä‘Ã³ng\n      cartService.clearCartFromStorage();\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi táº¡o Ä‘Æ¡n hÃ ng:', error);\n      throw error;\n    }\n  },\n  // LÃ m rá»—ng giá» hÃ ng\n  clearCart: async (email, cartId) => {\n    try {\n      // Æ¯u tiÃªn gá»i API xÃ³a toÃ n bá»™ (náº¿u backend há»— trá»£)\n      await api.delete(`/public/users/${email}/carts/${cartId}/clear`);\n    } catch (error) {\n      console.warn('ðŸ”„ Fallback: XÃ³a thá»§ cÃ´ng tá»«ng sáº£n pháº©m...');\n      const cart = await cartService.getActiveCart(email);\n      if (cart && cart.products) {\n        // Sá»­ dá»¥ng Promise.all Ä‘á»ƒ xÃ³a Ä‘á»“ng thá»i cÃ¡c sáº£n pháº©m, nhanh hÆ¡n vÃ²ng láº·p thÆ°á»ng\n        await Promise.all(cart.products.map(p => cartService.removeFromCart(cartId, p.productId)));\n      }\n    } finally {\n      cartService.clearCartFromStorage();\n    }\n  },\n  // ========== TIá»†N ÃCH (UTILITIES) ==========\n\n  // TÃ­nh tá»•ng tiá»n giá» hÃ ng\n  calculateTotal: cartItems => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      const price = item.specialPrice || item.price || 0;\n      return total + price * (item.quantity || 1);\n    }, 0);\n  },\n  // Äá»‹nh dáº¡ng giÃ¡ tiá»n VNÄ\n  formatPrice: price => {\n    return (Number(price) || 0).toLocaleString('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    });\n  },\n  // ========== QUáº¢N LÃ LOCAL STORAGE (Äá»’NG Bá»˜ UI) ==========\n\n  updateCartInStorage: cartData => {\n    try {\n      localStorage.setItem('cart', JSON.stringify(cartData));\n      // Dispatch event Ä‘á»ƒ cÃ¡c component khÃ¡c (nhÆ° Header) nháº­n biáº¿t sá»± thay Ä‘á»•i\n      window.dispatchEvent(new Event('cartUpdated'));\n    } catch (e) {\n      console.error('Error storage cart', e);\n    }\n  },\n  getCartFromStorage: () => {\n    const saved = localStorage.getItem('cart');\n    return saved ? JSON.parse(saved) : null;\n  },\n  clearCartFromStorage: () => {\n    localStorage.removeItem('cart');\n    window.dispatchEvent(new Event('cartUpdated'));\n  },\n  // Láº¥y tá»•ng sá»‘ lÆ°á»£ng item Ä‘á»ƒ hiá»ƒn thá»‹ Badge trÃªn icon Giá» hÃ ng\n  getCartCount: () => {\n    const cart = cartService.getCartFromStorage();\n    if (!cart || !cart.products) return 0;\n    return cart.products.reduce((sum, item) => sum + (item.quantity || 0), 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","getActiveCart","email","response","get","data","updateCartInStorage","error","console","addToCart","cartId","productId","quantity","post","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","shippingAddress","params","clearCartFromStorage","clearCart","warn","cart","products","Promise","all","map","p","calculateTotal","cartItems","length","reduce","total","item","price","specialPrice","formatPrice","Number","toLocaleString","style","currency","cartData","localStorage","setItem","JSON","stringify","window","dispatchEvent","Event","e","getCartFromStorage","saved","getItem","parse","removeItem","getCartCount","sum"],"sources":["E:/Java/DoAn/frontend/src/services/cartService.js"],"sourcesContent":["import api from './api';\n\nconst cartService = {\n  // ========== QUáº¢N LÃ GIá»Ž HÃ€NG (API) ==========\n\n  // Láº¥y giá» hÃ ng Ä‘ang hoáº¡t Ä‘á»™ng cá»§a ngÆ°á»i dÃ¹ng\n  getActiveCart: async (email) => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      if (response.data) {\n        cartService.updateCartInStorage(response.data); // Äá»“ng bá»™ LocalStorage\n      }\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi láº¥y giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      // Refresh láº¡i dá»¯ liá»‡u tá»« server sau khi thÃªm thÃ nh cÃ´ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh chÃ­nh xÃ¡c\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi thÃªm vÃ o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // Cáº­p nháº­t sá»‘ lÆ°á»£ng sáº£n pháº©m\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi cáº­p nháº­t sá»‘ lÆ°á»£ng:', error);\n      throw error;\n    }\n  },\n\n  // XÃ³a má»™t sáº£n pháº©m khá»i giá» hÃ ng\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi xÃ³a sáº£n pháº©m:', error);\n      throw error;\n    }\n  },\n\n  // ========== QUáº¢N LÃ Äáº¶T HÃ€NG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(\n        `/public/users/${email}/carts/${cartId}/place-order`,\n        null, \n        {\n          params: {\n            paymentMethod: paymentMethod,\n            shippingAddress: shippingAddress\n          }\n        }\n      );\n      \n      // Äáº¶C BIá»†T: Sau khi Ä‘áº·t hÃ ng thÃ nh cÃ´ng, giá» hÃ ng trÃªn server thÆ°á»ng sáº½ bá»‹ xÃ³a/Ä‘Ã³ng\n      cartService.clearCartFromStorage(); \n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi táº¡o Ä‘Æ¡n hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // LÃ m rá»—ng giá» hÃ ng\n  clearCart: async (email, cartId) => {\n    try {\n      // Æ¯u tiÃªn gá»i API xÃ³a toÃ n bá»™ (náº¿u backend há»— trá»£)\n      await api.delete(`/public/users/${email}/carts/${cartId}/clear`);\n    } catch (error) {\n      console.warn('ðŸ”„ Fallback: XÃ³a thá»§ cÃ´ng tá»«ng sáº£n pháº©m...');\n      const cart = await cartService.getActiveCart(email);\n      if (cart && cart.products) {\n        // Sá»­ dá»¥ng Promise.all Ä‘á»ƒ xÃ³a Ä‘á»“ng thá»i cÃ¡c sáº£n pháº©m, nhanh hÆ¡n vÃ²ng láº·p thÆ°á»ng\n        await Promise.all(\n          cart.products.map(p => cartService.removeFromCart(cartId, p.productId))\n        );\n      }\n    } finally {\n      cartService.clearCartFromStorage();\n    }\n  },\n\n  // ========== TIá»†N ÃCH (UTILITIES) ==========\n\n  // TÃ­nh tá»•ng tiá»n giá» hÃ ng\n  calculateTotal: (cartItems) => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      const price = item.specialPrice || item.price || 0;\n      return total + (price * (item.quantity || 1));\n    }, 0);\n  },\n\n  // Äá»‹nh dáº¡ng giÃ¡ tiá»n VNÄ\n  formatPrice: (price) => {\n    return (Number(price) || 0).toLocaleString('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    });\n  },\n\n  // ========== QUáº¢N LÃ LOCAL STORAGE (Äá»’NG Bá»˜ UI) ==========\n\n  updateCartInStorage: (cartData) => {\n    try {\n      localStorage.setItem('cart', JSON.stringify(cartData));\n      // Dispatch event Ä‘á»ƒ cÃ¡c component khÃ¡c (nhÆ° Header) nháº­n biáº¿t sá»± thay Ä‘á»•i\n      window.dispatchEvent(new Event('cartUpdated'));\n    } catch (e) {\n      console.error('Error storage cart', e);\n    }\n  },\n\n  getCartFromStorage: () => {\n    const saved = localStorage.getItem('cart');\n    return saved ? JSON.parse(saved) : null;\n  },\n\n  clearCartFromStorage: () => {\n    localStorage.removeItem('cart');\n    window.dispatchEvent(new Event('cartUpdated'));\n  },\n\n  // Láº¥y tá»•ng sá»‘ lÆ°á»£ng item Ä‘á»ƒ hiá»ƒn thá»‹ Badge trÃªn icon Giá» hÃ ng\n  getCartCount: () => {\n    const cart = cartService.getCartFromStorage();\n    if (!cart || !cart.products) return 0;\n    return cart.products.reduce((sum, item) => sum + (item.quantity || 0), 0);\n  }\n};\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}