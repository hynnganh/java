{"ast":null,"code":"// src/services/cartService.js\nimport api from \"./api\";\nconst cartService = {\n  /**\n   * ✅ Lấy giỏ hàng hiện tại của user\n   * @param {string} emailId - Email của user\n   */\n  async getCart(emailId) {\n    try {\n      const {\n        data\n      } = await api.get(`/public/users/${emailId}/carts/active`);\n      return data;\n    } catch (error) {\n      var _error$response;\n      // Nếu không tìm thấy cart active, trả về null thay vì throw error\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 404) {\n        return null;\n      }\n      console.error(\"❌ Lỗi khi lấy giỏ hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Thêm sản phẩm vào giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   * @param {number} quantity - Số lượng\n   */\n  async addToCart(cartId, productId, quantity = 1) {\n    try {\n      const {\n        data\n      } = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi thêm vào giỏ hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Cập nhật số lượng sản phẩm trong giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   * @param {number} quantity - Số lượng mới\n   */\n  async updateQuantity(cartId, productId, quantity) {\n    try {\n      const {\n        data\n      } = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi cập nhật số lượng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Xóa sản phẩm khỏi giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   */\n  async removeFromCart(cartId, productId) {\n    try {\n      await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return true;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi xóa khỏi giỏ hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Tạo đơn hàng từ giỏ hàng\n   * @param {string} emailId - Email của user\n   * @param {number} cartId - ID giỏ hàng\n   * @param {string} paymentMethod - Phương thức thanh toán\n   */\n  async createOrder(emailId, cartId, paymentMethod = \"COD\") {\n    try {\n      const {\n        data\n      } = await api.post(`/public/users/${emailId}/carts/${cartId}/payments/${paymentMethod}/order`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi tạo đơn hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Lấy danh sách đơn hàng của user\n   * @param {string} emailId - Email của user\n   */\n  async getUserOrders(emailId) {\n    try {\n      const {\n        data\n      } = await api.get(`/public/users/${emailId}/orders`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy danh sách đơn hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Lấy chi tiết đơn hàng\n   * @param {string} emailId - Email của user\n   * @param {number} orderId - ID đơn hàng\n   */\n  async getOrderDetail(emailId, orderId) {\n    try {\n      const {\n        data\n      } = await api.get(`/public/users/${emailId}/orders/${orderId}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy chi tiết đơn hàng:\", error);\n      throw error;\n    }\n  },\n  /**\n   * ✅ Tính tổng tiền giỏ hàng\n   * @param {Array} cartItems - Danh sách sản phẩm trong giỏ\n   */\n  calculateTotal(cartItems) {\n    if (!cartItems || !Array.isArray(cartItems)) return 0;\n    return cartItems.reduce((total, item) => {\n      var _item$product;\n      const price = ((_item$product = item.product) === null || _item$product === void 0 ? void 0 : _item$product.price) || item.price || 0;\n      const quantity = item.quantity || 0;\n      return total + price * quantity;\n    }, 0);\n  },\n  /**\n   * ✅ Đếm tổng số lượng sản phẩm trong giỏ\n   * @param {Array} cartItems - Danh sách sản phẩm trong giỏ\n   */\n  getTotalQuantity(cartItems) {\n    if (!cartItems || !Array.isArray(cartItems)) return 0;\n    return cartItems.reduce((total, item) => total + (item.quantity || 0), 0);\n  },\n  /**\n   * ✅ Lấy số lượng giỏ hàng để hiển thị badge\n   * @param {string} emailId - Email của user\n   */\n  async getCartCount(emailId) {\n    try {\n      const cart = await this.getCart(emailId);\n      return this.getTotalQuantity(cart === null || cart === void 0 ? void 0 : cart.cartItems);\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy số lượng giỏ hàng:\", error);\n      return 0;\n    }\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","getCart","emailId","data","get","error","_error$response","response","status","console","addToCart","cartId","productId","quantity","post","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","getUserOrders","getOrderDetail","orderId","calculateTotal","cartItems","Array","isArray","reduce","total","item","_item$product","price","product","getTotalQuantity","getCartCount","cart"],"sources":["D:/JVA/frontend/src/services/cartService.js"],"sourcesContent":["// src/services/cartService.js\nimport api from \"./api\";\n\nconst cartService = {\n  /**\n   * ✅ Lấy giỏ hàng hiện tại của user\n   * @param {string} emailId - Email của user\n   */\n  async getCart(emailId) {\n    try {\n      const { data } = await api.get(`/public/users/${emailId}/carts/active`);\n      return data;\n    } catch (error) {\n      // Nếu không tìm thấy cart active, trả về null thay vì throw error\n      if (error.response?.status === 404) {\n        return null;\n      }\n      console.error(\"❌ Lỗi khi lấy giỏ hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Thêm sản phẩm vào giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   * @param {number} quantity - Số lượng\n   */\n  async addToCart(cartId, productId, quantity = 1) {\n    try {\n      const { data } = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi thêm vào giỏ hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Cập nhật số lượng sản phẩm trong giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   * @param {number} quantity - Số lượng mới\n   */\n  async updateQuantity(cartId, productId, quantity) {\n    try {\n      const { data } = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi cập nhật số lượng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Xóa sản phẩm khỏi giỏ hàng\n   * @param {number} cartId - ID giỏ hàng\n   * @param {number} productId - ID sản phẩm\n   */\n  async removeFromCart(cartId, productId) {\n    try {\n      await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return true;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi xóa khỏi giỏ hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Tạo đơn hàng từ giỏ hàng\n   * @param {string} emailId - Email của user\n   * @param {number} cartId - ID giỏ hàng\n   * @param {string} paymentMethod - Phương thức thanh toán\n   */\n  async createOrder(emailId, cartId, paymentMethod = \"COD\") {\n    try {\n      const { data } = await api.post(`/public/users/${emailId}/carts/${cartId}/payments/${paymentMethod}/order`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi tạo đơn hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Lấy danh sách đơn hàng của user\n   * @param {string} emailId - Email của user\n   */\n  async getUserOrders(emailId) {\n    try {\n      const { data } = await api.get(`/public/users/${emailId}/orders`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy danh sách đơn hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Lấy chi tiết đơn hàng\n   * @param {string} emailId - Email của user\n   * @param {number} orderId - ID đơn hàng\n   */\n  async getOrderDetail(emailId, orderId) {\n    try {\n      const { data } = await api.get(`/public/users/${emailId}/orders/${orderId}`);\n      return data;\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy chi tiết đơn hàng:\", error);\n      throw error;\n    }\n  },\n\n  /**\n   * ✅ Tính tổng tiền giỏ hàng\n   * @param {Array} cartItems - Danh sách sản phẩm trong giỏ\n   */\n  calculateTotal(cartItems) {\n    if (!cartItems || !Array.isArray(cartItems)) return 0;\n    \n    return cartItems.reduce((total, item) => {\n      const price = item.product?.price || item.price || 0;\n      const quantity = item.quantity || 0;\n      return total + (price * quantity);\n    }, 0);\n  },\n\n  /**\n   * ✅ Đếm tổng số lượng sản phẩm trong giỏ\n   * @param {Array} cartItems - Danh sách sản phẩm trong giỏ\n   */\n  getTotalQuantity(cartItems) {\n    if (!cartItems || !Array.isArray(cartItems)) return 0;\n    \n    return cartItems.reduce((total, item) => total + (item.quantity || 0), 0);\n  },\n\n  /**\n   * ✅ Lấy số lượng giỏ hàng để hiển thị badge\n   * @param {string} emailId - Email của user\n   */\n  async getCartCount(emailId) {\n    try {\n      const cart = await this.getCart(emailId);\n      return this.getTotalQuantity(cart?.cartItems);\n    } catch (error) {\n      console.error(\"❌ Lỗi khi lấy số lượng giỏ hàng:\", error);\n      return 0;\n    }\n  }\n};\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}