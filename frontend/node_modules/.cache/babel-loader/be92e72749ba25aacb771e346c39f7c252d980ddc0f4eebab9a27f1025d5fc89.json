{"ast":null,"code":"import api from './api';\nconst orderService = {\n  // ========== USER APIs ==========\n\n  getUserOrders: async email => {\n    try {\n      const response = await api.get(`/public/users/${email}/orders`);\n      const orders = Array.isArray(response.data) ? response.data : [];\n      return orders.map(order => ({\n        ...order,\n        products: orderService.getOrderProducts(order),\n        totalAmount: order.totalAmount || order.totalPrice || 0\n      }));\n    } catch (error) {\n      console.error('❌ Lỗi load đơn hàng:', error);\n      throw error;\n    }\n  },\n  getOrderDetail: async (email, orderId) => {\n    try {\n      const response = await api.get(`/public/users/${email}/orders/${orderId}`);\n      const order = response.data;\n      return {\n        ...order,\n        products: orderService.getOrderProducts(order),\n        totalAmount: order.totalAmount || order.totalPrice || 0\n      };\n    } catch (error) {\n      console.error('❌ Lỗi lấy chi tiết đơn hàng:', error);\n      throw error;\n    }\n  },\n  // FIX LỖI 401 VÀ GỬI REASON CHUẨN\n  cancelOrder: async (email, orderId, reason) => {\n    try {\n      // Dùng instance 'api' để lấy baseURL config sẵn\n      const response = await api.put(`/public/users/${email}/orders/${orderId}/cancel`, null, {\n        params: {\n          reason: reason\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi hủy đơn hàng:', error);\n      throw error;\n    }\n  },\n  createOrderFromCart: async (email, cartId, paymentMethod, shippingAddress) => {\n    const response = await api.post(`/public/users/${email}/carts/${cartId}/place-order`, null, {\n      params: {\n        paymentMethod,\n        shippingAddress\n      }\n    });\n    return response.data;\n  },\n  // ========== ADMIN APIs ==========\n\n  getAllOrders: async () => {\n    const response = await api.get('/admin/orders');\n    return response.data;\n  },\n  updateOrderStatus: async (orderId, status) => {\n    const response = await api.put(`/admin/orders/${orderId}/status`, null, {\n      params: {\n        status\n      }\n    });\n    return response.data;\n  },\n  // ========== UTILITIES (Dọn dẹp trùng lặp) ==========\n\n  formatOrderStatus: status => {\n    const statusMap = {\n      'PENDING': {\n        text: 'Chờ xác nhận',\n        class: 'warning'\n      },\n      'Order Accepted !': {\n        text: 'Đã xác nhận',\n        class: 'info'\n      },\n      'SHIPPED': {\n        text: 'Đang giao hàng',\n        class: 'secondary'\n      },\n      'DELIVERED': {\n        text: 'Đã giao hàng',\n        class: 'success'\n      },\n      'CANCELLED': {\n        text: 'Đã hủy',\n        class: 'danger'\n      }\n    };\n    return statusMap[status] || {\n      text: status,\n      class: 'secondary'\n    };\n  },\n  formatPrice: price => {\n    return (Number(price) || 0).toLocaleString('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    });\n  },\n  getOrderProducts: order => {\n    if (!order || !order.orderItems) return [];\n    return order.orderItems.map(item => {\n      var _item$product;\n      return {\n        ...item.product,\n        quantity: item.quantity,\n        orderedProductPrice: item.orderedProductPrice,\n        productName: ((_item$product = item.product) === null || _item$product === void 0 ? void 0 : _item$product.productName) || 'Sản phẩm không tên'\n      };\n    });\n  },\n  calculateOrderTotal: order => {\n    if (!order) return 0;\n    if (order.totalAmount) return order.totalAmount;\n    const items = order.orderItems || [];\n    return items.reduce((total, item) => {\n      return total + item.orderedProductPrice * item.quantity;\n    }, 0);\n  }\n};\nexport default orderService;","map":{"version":3,"names":["api","orderService","getUserOrders","email","response","get","orders","Array","isArray","data","map","order","products","getOrderProducts","totalAmount","totalPrice","error","console","getOrderDetail","orderId","cancelOrder","reason","put","params","createOrderFromCart","cartId","paymentMethod","shippingAddress","post","getAllOrders","updateOrderStatus","status","formatOrderStatus","statusMap","text","class","formatPrice","price","Number","toLocaleString","style","currency","orderItems","item","_item$product","product","quantity","orderedProductPrice","productName","calculateOrderTotal","items","reduce","total"],"sources":["E:/Java/DoAn/frontend/src/services/orderService.js"],"sourcesContent":["import api from './api';\n\nconst orderService = {\n  // ========== USER APIs ==========\n\n  getUserOrders: async (email) => {\n    try {\n      const response = await api.get(`/public/users/${email}/orders`);\n      const orders = Array.isArray(response.data) ? response.data : [];\n      \n      return orders.map(order => ({\n        ...order,\n        products: orderService.getOrderProducts(order),\n        totalAmount: order.totalAmount || order.totalPrice || 0\n      }));\n    } catch (error) {\n      console.error('❌ Lỗi load đơn hàng:', error);\n      throw error;\n    }\n  },\n\n  getOrderDetail: async (email, orderId) => {\n    try {\n      const response = await api.get(`/public/users/${email}/orders/${orderId}`);\n      const order = response.data;\n      return {\n        ...order,\n        products: orderService.getOrderProducts(order),\n        totalAmount: order.totalAmount || order.totalPrice || 0\n      };\n    } catch (error) {\n      console.error('❌ Lỗi lấy chi tiết đơn hàng:', error);\n      throw error;\n    }\n  },\n\n  // FIX LỖI 401 VÀ GỬI REASON CHUẨN\n  cancelOrder: async (email, orderId, reason) => {\n    try {\n      // Dùng instance 'api' để lấy baseURL config sẵn\n      const response = await api.put(\n        `/public/users/${email}/orders/${orderId}/cancel`, \n        null, \n        {\n          params: { reason: reason }\n        }\n      );\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi hủy đơn hàng:', error);\n      throw error;\n    }\n  },\n\n  createOrderFromCart: async (email, cartId, paymentMethod, shippingAddress) => {\n    const response = await api.post(\n      `/public/users/${email}/carts/${cartId}/place-order`,\n      null,\n      { params: { paymentMethod, shippingAddress } }\n    );\n    return response.data;\n  },\n\n  // ========== ADMIN APIs ==========\n\n  getAllOrders: async () => {\n    const response = await api.get('/admin/orders');\n    return response.data;\n  },\n\n  updateOrderStatus: async (orderId, status) => {\n    const response = await api.put(`/admin/orders/${orderId}/status`, null, {\n      params: { status }\n    });\n    return response.data;\n  },\n\n  // ========== UTILITIES (Dọn dẹp trùng lặp) ==========\n\n  formatOrderStatus: (status) => {\n    const statusMap = {\n      'PENDING': { text: 'Chờ xác nhận', class: 'warning' },\n      'Order Accepted !': { text: 'Đã xác nhận', class: 'info' },\n      'SHIPPED': { text: 'Đang giao hàng', class: 'secondary' },\n      'DELIVERED': { text: 'Đã giao hàng', class: 'success' },\n      'CANCELLED': { text: 'Đã hủy', class: 'danger' }\n    };\n    return statusMap[status] || { text: status, class: 'secondary' };\n  },\n\n  formatPrice: (price) => {\n    return (Number(price) || 0).toLocaleString('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    });\n  },\n\n  getOrderProducts: (order) => {\n    if (!order || !order.orderItems) return [];\n    return order.orderItems.map(item => ({\n      ...item.product,\n      quantity: item.quantity,\n      orderedProductPrice: item.orderedProductPrice,\n      productName: item.product?.productName || 'Sản phẩm không tên'\n    }));\n  },\n\n  calculateOrderTotal: (order) => {\n    if (!order) return 0;\n    if (order.totalAmount) return order.totalAmount;\n    \n    const items = order.orderItems || [];\n    return items.reduce((total, item) => {\n      return total + (item.orderedProductPrice * item.quantity);\n    }, 0);\n  }\n};\n\nexport default orderService;"],"mappings":"AAAA,OAAOA,GAAG,MAAM,OAAO;AAEvB,MAAMC,YAAY,GAAG;EACnB;;EAEAC,aAAa,EAAE,MAAOC,KAAK,IAAK;IAC9B,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMJ,GAAG,CAACK,GAAG,CAAC,iBAAiBF,KAAK,SAAS,CAAC;MAC/D,MAAMG,MAAM,GAAGC,KAAK,CAACC,OAAO,CAACJ,QAAQ,CAACK,IAAI,CAAC,GAAGL,QAAQ,CAACK,IAAI,GAAG,EAAE;MAEhE,OAAOH,MAAM,CAACI,GAAG,CAACC,KAAK,KAAK;QAC1B,GAAGA,KAAK;QACRC,QAAQ,EAAEX,YAAY,CAACY,gBAAgB,CAACF,KAAK,CAAC;QAC9CG,WAAW,EAAEH,KAAK,CAACG,WAAW,IAAIH,KAAK,CAACI,UAAU,IAAI;MACxD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;MAC5C,MAAMA,KAAK;IACb;EACF,CAAC;EAEDE,cAAc,EAAE,MAAAA,CAAOf,KAAK,EAAEgB,OAAO,KAAK;IACxC,IAAI;MACF,MAAMf,QAAQ,GAAG,MAAMJ,GAAG,CAACK,GAAG,CAAC,iBAAiBF,KAAK,WAAWgB,OAAO,EAAE,CAAC;MAC1E,MAAMR,KAAK,GAAGP,QAAQ,CAACK,IAAI;MAC3B,OAAO;QACL,GAAGE,KAAK;QACRC,QAAQ,EAAEX,YAAY,CAACY,gBAAgB,CAACF,KAAK,CAAC;QAC9CG,WAAW,EAAEH,KAAK,CAACG,WAAW,IAAIH,KAAK,CAACI,UAAU,IAAI;MACxD,CAAC;IACH,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;MACpD,MAAMA,KAAK;IACb;EACF,CAAC;EAED;EACAI,WAAW,EAAE,MAAAA,CAAOjB,KAAK,EAAEgB,OAAO,EAAEE,MAAM,KAAK;IAC7C,IAAI;MACF;MACA,MAAMjB,QAAQ,GAAG,MAAMJ,GAAG,CAACsB,GAAG,CAC5B,iBAAiBnB,KAAK,WAAWgB,OAAO,SAAS,EACjD,IAAI,EACJ;QACEI,MAAM,EAAE;UAAEF,MAAM,EAAEA;QAAO;MAC3B,CACF,CAAC;MACD,OAAOjB,QAAQ,CAACK,IAAI;IACtB,CAAC,CAAC,OAAOO,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/C,MAAMA,KAAK;IACb;EACF,CAAC;EAEDQ,mBAAmB,EAAE,MAAAA,CAAOrB,KAAK,EAAEsB,MAAM,EAAEC,aAAa,EAAEC,eAAe,KAAK;IAC5E,MAAMvB,QAAQ,GAAG,MAAMJ,GAAG,CAAC4B,IAAI,CAC7B,iBAAiBzB,KAAK,UAAUsB,MAAM,cAAc,EACpD,IAAI,EACJ;MAAEF,MAAM,EAAE;QAAEG,aAAa;QAAEC;MAAgB;IAAE,CAC/C,CAAC;IACD,OAAOvB,QAAQ,CAACK,IAAI;EACtB,CAAC;EAED;;EAEAoB,YAAY,EAAE,MAAAA,CAAA,KAAY;IACxB,MAAMzB,QAAQ,GAAG,MAAMJ,GAAG,CAACK,GAAG,CAAC,eAAe,CAAC;IAC/C,OAAOD,QAAQ,CAACK,IAAI;EACtB,CAAC;EAEDqB,iBAAiB,EAAE,MAAAA,CAAOX,OAAO,EAAEY,MAAM,KAAK;IAC5C,MAAM3B,QAAQ,GAAG,MAAMJ,GAAG,CAACsB,GAAG,CAAC,iBAAiBH,OAAO,SAAS,EAAE,IAAI,EAAE;MACtEI,MAAM,EAAE;QAAEQ;MAAO;IACnB,CAAC,CAAC;IACF,OAAO3B,QAAQ,CAACK,IAAI;EACtB,CAAC;EAED;;EAEAuB,iBAAiB,EAAGD,MAAM,IAAK;IAC7B,MAAME,SAAS,GAAG;MAChB,SAAS,EAAE;QAAEC,IAAI,EAAE,cAAc;QAAEC,KAAK,EAAE;MAAU,CAAC;MACrD,kBAAkB,EAAE;QAAED,IAAI,EAAE,aAAa;QAAEC,KAAK,EAAE;MAAO,CAAC;MAC1D,SAAS,EAAE;QAAED,IAAI,EAAE,gBAAgB;QAAEC,KAAK,EAAE;MAAY,CAAC;MACzD,WAAW,EAAE;QAAED,IAAI,EAAE,cAAc;QAAEC,KAAK,EAAE;MAAU,CAAC;MACvD,WAAW,EAAE;QAAED,IAAI,EAAE,QAAQ;QAAEC,KAAK,EAAE;MAAS;IACjD,CAAC;IACD,OAAOF,SAAS,CAACF,MAAM,CAAC,IAAI;MAAEG,IAAI,EAAEH,MAAM;MAAEI,KAAK,EAAE;IAAY,CAAC;EAClE,CAAC;EAEDC,WAAW,EAAGC,KAAK,IAAK;IACtB,OAAO,CAACC,MAAM,CAACD,KAAK,CAAC,IAAI,CAAC,EAAEE,cAAc,CAAC,OAAO,EAAE;MAClDC,KAAK,EAAE,UAAU;MACjBC,QAAQ,EAAE;IACZ,CAAC,CAAC;EACJ,CAAC;EAED5B,gBAAgB,EAAGF,KAAK,IAAK;IAC3B,IAAI,CAACA,KAAK,IAAI,CAACA,KAAK,CAAC+B,UAAU,EAAE,OAAO,EAAE;IAC1C,OAAO/B,KAAK,CAAC+B,UAAU,CAAChC,GAAG,CAACiC,IAAI;MAAA,IAAAC,aAAA;MAAA,OAAK;QACnC,GAAGD,IAAI,CAACE,OAAO;QACfC,QAAQ,EAAEH,IAAI,CAACG,QAAQ;QACvBC,mBAAmB,EAAEJ,IAAI,CAACI,mBAAmB;QAC7CC,WAAW,EAAE,EAAAJ,aAAA,GAAAD,IAAI,CAACE,OAAO,cAAAD,aAAA,uBAAZA,aAAA,CAAcI,WAAW,KAAI;MAC5C,CAAC;IAAA,CAAC,CAAC;EACL,CAAC;EAEDC,mBAAmB,EAAGtC,KAAK,IAAK;IAC9B,IAAI,CAACA,KAAK,EAAE,OAAO,CAAC;IACpB,IAAIA,KAAK,CAACG,WAAW,EAAE,OAAOH,KAAK,CAACG,WAAW;IAE/C,MAAMoC,KAAK,GAAGvC,KAAK,CAAC+B,UAAU,IAAI,EAAE;IACpC,OAAOQ,KAAK,CAACC,MAAM,CAAC,CAACC,KAAK,EAAET,IAAI,KAAK;MACnC,OAAOS,KAAK,GAAIT,IAAI,CAACI,mBAAmB,GAAGJ,IAAI,CAACG,QAAS;IAC3D,CAAC,EAAE,CAAC,CAAC;EACP;AACF,CAAC;AAED,eAAe7C,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}