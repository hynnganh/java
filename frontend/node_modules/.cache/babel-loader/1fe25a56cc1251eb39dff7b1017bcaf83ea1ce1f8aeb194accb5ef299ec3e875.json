{"ast":null,"code":"// services/cartService.js\nimport api from './api';\nconst cartService = {\n  // ========== QUẢN LÝ GIỎ HÀNG ==========\n\n  getActiveCart: async email => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      // Thử gọi endpoint lấy danh sách carts thay vì /active\n      const response = await api.get(`/public/users/${email}/carts`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n\n      // Nếu Backend trả về mảng, lấy cái đầu tiên\n      const carts = response.data;\n      return Array.isArray(carts) ? carts[0] : carts;\n    } catch (error) {\n      console.error('❌ Lỗi giỏ hàng:', error.response);\n      throw error;\n    }\n  },\n  // Tạo giỏ hàng mới\n  createCart: async email => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo giỏ hàng:', error);\n      throw error;\n    }\n  },\n  // Thêm sản phẩm vào giỏ hàng\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      // Đảm bảo productId là số\n      const pId = Number(productId);\n      const response = await api.post(`/public/carts/${cartId}/products/${pId}/quantity/${quantity}`);\n\n      // Sau khi thêm thành công, cập nhật lại giỏ hàng trong LocalStorage để đồng bộ\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      await cartService.refreshCart(user.email);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi thêm vào giỏ hàng:', error);\n      throw error;\n    }\n  },\n  // Cập nhật số lượng sản phẩm\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi cập nhật số lượng:', error);\n      throw error;\n    }\n  },\n  // Xóa 1 sản phẩm khỏi giỏ\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi xóa sản phẩm:', error);\n      throw error;\n    }\n  },\n  // ========== QUẢN LÝ ĐƠN HÀNG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts/${cartId}/place-order`, null, {\n        params: {\n          paymentMethod: paymentMethod,\n          shippingAddress: shippingAddress\n        }\n      });\n      // Sau khi đặt hàng thành công, giỏ hàng cũ thường bị đóng/xóa\n      localStorage.removeItem('cart');\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi tạo đơn hàng:', error);\n      throw error;\n    }\n  },\n  // ========== TIỆN ÍCH (UTILITIES) ==========\n\n  // Làm mới dữ liệu giỏ hàng từ Server và lưu vào LocalStorage\n  refreshCart: async email => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        // Cập nhật cartId vào object user để dùng cho các hàm khác\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId;\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      console.error('Error refreshing cart:', error);\n      return null;\n    }\n  },\n  // Lấy tổng số lượng sản phẩm để hiển thị trên Icon Header\n  getCartCount: async email => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      // Tính tổng số lượng (quantity) của tất cả sản phẩm trong mảng\n      return cart.products.reduce((total, item) => total + (item.quantity || 0), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n  // Format tiền VND\n  formatPrice: price => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(price || 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","getActiveCart","email","token","localStorage","getItem","response","get","headers","Authorization","carts","data","Array","isArray","error","console","createCart","post","addToCart","cartId","productId","quantity","pId","Number","user","JSON","parse","refreshCart","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","shippingAddress","params","removeItem","cart","setItem","stringify","getCartCount","products","reduce","total","item","formatPrice","price","Intl","NumberFormat","style","currency","format"],"sources":["E:/Java/DoAn/frontend/src/services/cartService.js"],"sourcesContent":["// services/cartService.js\nimport api from './api';\n\nconst cartService = {\n  // ========== QUẢN LÝ GIỎ HÀNG ==========\n\ngetActiveCart: async (email) => {\n  try {\n    const token = localStorage.getItem(\"token\");\n    // Thử gọi endpoint lấy danh sách carts thay vì /active\n    const response = await api.get(`/public/users/${email}/carts`, {\n      headers: { Authorization: `Bearer ${token}` }\n    });\n\n    // Nếu Backend trả về mảng, lấy cái đầu tiên\n    const carts = response.data;\n    return Array.isArray(carts) ? carts[0] : carts;\n  } catch (error) {\n    console.error('❌ Lỗi giỏ hàng:', error.response);\n    throw error;\n  }\n},\n  // Tạo giỏ hàng mới\n  createCart: async (email) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi tạo giỏ hàng:', error);\n      throw error;\n    }\n  },\n\n  // Thêm sản phẩm vào giỏ hàng\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      // Đảm bảo productId là số\n      const pId = Number(productId);\n      const response = await api.post(`/public/carts/${cartId}/products/${pId}/quantity/${quantity}`);\n      \n      // Sau khi thêm thành công, cập nhật lại giỏ hàng trong LocalStorage để đồng bộ\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      await cartService.refreshCart(user.email);\n      \n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi thêm vào giỏ hàng:', error);\n      throw error;\n    }\n  },\n\n  // Cập nhật số lượng sản phẩm\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi cập nhật số lượng:', error);\n      throw error;\n    }\n  },\n\n  // Xóa 1 sản phẩm khỏi giỏ\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi khi xóa sản phẩm:', error);\n      throw error;\n    }\n  },\n\n  // ========== QUẢN LÝ ĐƠN HÀNG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(\n        `/public/users/${email}/carts/${cartId}/place-order`,\n        null,\n        {\n          params: {\n            paymentMethod: paymentMethod,\n            shippingAddress: shippingAddress\n          }\n        }\n      );\n      // Sau khi đặt hàng thành công, giỏ hàng cũ thường bị đóng/xóa\n      localStorage.removeItem('cart'); \n      return response.data;\n    } catch (error) {\n      console.error('❌ Lỗi tạo đơn hàng:', error);\n      throw error;\n    }\n  },\n\n  // ========== TIỆN ÍCH (UTILITIES) ==========\n\n  // Làm mới dữ liệu giỏ hàng từ Server và lưu vào LocalStorage\n  refreshCart: async (email) => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        // Cập nhật cartId vào object user để dùng cho các hàm khác\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId;\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      console.error('Error refreshing cart:', error);\n      return null;\n    }\n  },\n\n  // Lấy tổng số lượng sản phẩm để hiển thị trên Icon Header\n  getCartCount: async (email) => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      // Tính tổng số lượng (quantity) của tất cả sản phẩm trong mảng\n      return cart.products.reduce((total, item) => total + (item.quantity || 0), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n\n  // Format tiền VND\n  formatPrice: (price) => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(price || 0);\n  }\n};\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}