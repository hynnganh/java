{"ast":null,"code":"// services/cartService.js\nimport api from './api';\nconst cartService = {\n  // ========== QUáº¢N LÃ GIá»Ž HÃ€NG ==========\n\n  // Láº¥y giá» hÃ ng Ä‘ang hoáº¡t Ä‘á»™ng (Tá»± Ä‘á»™ng táº¡o náº¿u chÆ°a cÃ³)\n  getActiveCart: async email => {\n    try {\n      // Thá»­ láº¥y giá» hÃ ng active\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      var _error$response;\n      // Náº¿u lá»—i 404 (chÆ°a cÃ³ giá»), tiáº¿n hÃ nh táº¡o má»›i\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 404) {\n        console.log(\"ðŸ†• KhÃ´ng tÃ¬m tháº¥y giá» hÃ ng active, Ä‘ang táº¡o má»›i...\");\n        return await cartService.createCart(email);\n      }\n      console.error('âŒ Lá»—i khi láº¥y giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n  // Táº¡o giá» hÃ ng má»›i\n  createCart: async email => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi táº¡o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n  // ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      // Äáº£m báº£o productId lÃ  sá»‘\n      const pId = Number(productId);\n      const response = await api.post(`/public/carts/${cartId}/products/${pId}/quantity/${quantity}`);\n\n      // Sau khi thÃªm thÃ nh cÃ´ng, cáº­p nháº­t láº¡i giá» hÃ ng trong LocalStorage Ä‘á»ƒ Ä‘á»“ng bá»™\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      await cartService.refreshCart(user.email);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi thÃªm vÃ o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n  // Cáº­p nháº­t sá»‘ lÆ°á»£ng sáº£n pháº©m\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi cáº­p nháº­t sá»‘ lÆ°á»£ng:', error);\n      throw error;\n    }\n  },\n  // XÃ³a 1 sáº£n pháº©m khá»i giá»\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi xÃ³a sáº£n pháº©m:', error);\n      throw error;\n    }\n  },\n  // ========== QUáº¢N LÃ ÄÆ N HÃ€NG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts/${cartId}/place-order`, null, {\n        params: {\n          paymentMethod: paymentMethod,\n          shippingAddress: shippingAddress\n        }\n      });\n      // Sau khi Ä‘áº·t hÃ ng thÃ nh cÃ´ng, giá» hÃ ng cÅ© thÆ°á»ng bá»‹ Ä‘Ã³ng/xÃ³a\n      localStorage.removeItem('cart');\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i táº¡o Ä‘Æ¡n hÃ ng:', error);\n      throw error;\n    }\n  },\n  // ========== TIá»†N ÃCH (UTILITIES) ==========\n\n  // LÃ m má»›i dá»¯ liá»‡u giá» hÃ ng tá»« Server vÃ  lÆ°u vÃ o LocalStorage\n  refreshCart: async email => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        // Cáº­p nháº­t cartId vÃ o object user Ä‘á»ƒ dÃ¹ng cho cÃ¡c hÃ m khÃ¡c\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId;\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      console.error('Error refreshing cart:', error);\n      return null;\n    }\n  },\n  // Láº¥y tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn Icon Header\n  getCartCount: async email => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      // TÃ­nh tá»•ng sá»‘ lÆ°á»£ng (quantity) cá»§a táº¥t cáº£ sáº£n pháº©m trong máº£ng\n      return cart.products.reduce((total, item) => total + (item.quantity || 0), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n  // Format tiá»n VND\n  formatPrice: price => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(price || 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","getActiveCart","email","response","get","data","error","_error$response","status","console","log","createCart","post","addToCart","cartId","productId","quantity","pId","Number","user","JSON","parse","localStorage","getItem","refreshCart","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","shippingAddress","params","removeItem","cart","setItem","stringify","getCartCount","products","reduce","total","item","formatPrice","price","Intl","NumberFormat","style","currency","format"],"sources":["E:/Java/DoAn/frontend/src/services/cartService.js"],"sourcesContent":["// services/cartService.js\nimport api from './api';\n\nconst cartService = {\n  // ========== QUáº¢N LÃ GIá»Ž HÃ€NG ==========\n\n  // Láº¥y giá» hÃ ng Ä‘ang hoáº¡t Ä‘á»™ng (Tá»± Ä‘á»™ng táº¡o náº¿u chÆ°a cÃ³)\n  getActiveCart: async (email) => {\n    try {\n      // Thá»­ láº¥y giá» hÃ ng active\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      // Náº¿u lá»—i 404 (chÆ°a cÃ³ giá»), tiáº¿n hÃ nh táº¡o má»›i\n      if (error.response?.status === 404) {\n        console.log(\"ðŸ†• KhÃ´ng tÃ¬m tháº¥y giá» hÃ ng active, Ä‘ang táº¡o má»›i...\");\n        return await cartService.createCart(email);\n      }\n      console.error('âŒ Lá»—i khi láº¥y giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // Táº¡o giá» hÃ ng má»›i\n  createCart: async (email) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi táº¡o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng\n  addToCart: async (cartId, productId, quantity = 1) => {\n    try {\n      // Äáº£m báº£o productId lÃ  sá»‘\n      const pId = Number(productId);\n      const response = await api.post(`/public/carts/${cartId}/products/${pId}/quantity/${quantity}`);\n      \n      // Sau khi thÃªm thÃ nh cÃ´ng, cáº­p nháº­t láº¡i giá» hÃ ng trong LocalStorage Ä‘á»ƒ Ä‘á»“ng bá»™\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      await cartService.refreshCart(user.email);\n      \n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi thÃªm vÃ o giá» hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // Cáº­p nháº­t sá»‘ lÆ°á»£ng sáº£n pháº©m\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi cáº­p nháº­t sá»‘ lÆ°á»£ng:', error);\n      throw error;\n    }\n  },\n\n  // XÃ³a 1 sáº£n pháº©m khá»i giá»\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i khi xÃ³a sáº£n pháº©m:', error);\n      throw error;\n    }\n  },\n\n  // ========== QUáº¢N LÃ ÄÆ N HÃ€NG (ORDER) ==========\n\n  createOrder: async (email, cartId, paymentMethod, shippingAddress) => {\n    try {\n      const response = await api.post(\n        `/public/users/${email}/carts/${cartId}/place-order`,\n        null,\n        {\n          params: {\n            paymentMethod: paymentMethod,\n            shippingAddress: shippingAddress\n          }\n        }\n      );\n      // Sau khi Ä‘áº·t hÃ ng thÃ nh cÃ´ng, giá» hÃ ng cÅ© thÆ°á»ng bá»‹ Ä‘Ã³ng/xÃ³a\n      localStorage.removeItem('cart'); \n      return response.data;\n    } catch (error) {\n      console.error('âŒ Lá»—i táº¡o Ä‘Æ¡n hÃ ng:', error);\n      throw error;\n    }\n  },\n\n  // ========== TIá»†N ÃCH (UTILITIES) ==========\n\n  // LÃ m má»›i dá»¯ liá»‡u giá» hÃ ng tá»« Server vÃ  lÆ°u vÃ o LocalStorage\n  refreshCart: async (email) => {\n    if (!email) return null;\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (cart) {\n        localStorage.setItem('cart', JSON.stringify(cart));\n        // Cáº­p nháº­t cartId vÃ o object user Ä‘á»ƒ dÃ¹ng cho cÃ¡c hÃ m khÃ¡c\n        const user = JSON.parse(localStorage.getItem('user') || '{}');\n        user.cartId = cart.cartId;\n        localStorage.setItem('user', JSON.stringify(user));\n      }\n      return cart;\n    } catch (error) {\n      console.error('Error refreshing cart:', error);\n      return null;\n    }\n  },\n\n  // Láº¥y tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn Icon Header\n  getCartCount: async (email) => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      // TÃ­nh tá»•ng sá»‘ lÆ°á»£ng (quantity) cá»§a táº¥t cáº£ sáº£n pháº©m trong máº£ng\n      return cart.products.reduce((total, item) => total + (item.quantity || 0), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n\n  // Format tiá»n VND\n  formatPrice: (price) => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(price || 0);\n  }\n};\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}