{"ast":null,"code":"// services/cartService.js\nimport api from './api';\nconst cartService = {\n  // T·∫°o gi·ªè h√†ng m·ªõi\n  createCart: async email => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi t·∫°o gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n  // L·∫•y gi·ªè h√†ng active\n  getActiveCart: async email => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi l·∫•y gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n  // Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi th√™m v√†o gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n  // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng:', error);\n      throw error;\n    }\n  },\n  // X√≥a s·∫£n ph·∫©m\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi x√≥a s·∫£n ph·∫©m:', error);\n      throw error;\n    }\n  },\n  // T·∫°o ƒë∆°n h√†ng - FIXED\n  createOrder: async (email, cartId, paymentMethod) => {\n    try {\n      console.log('üí∞ T·∫°o ƒë∆°n h√†ng v·ªõi:', {\n        email,\n        cartId,\n        paymentMethod\n      });\n\n      // S·ª≠a endpoint theo ƒë√∫ng API c·ªßa b·∫°n\n      const response = await api.post(`/public/user=${email}/carts/${cartId}/payments/${paymentMethod}/order`);\n      console.log('‚úÖ ƒê∆°n h√†ng t·∫°o th√†nh c√¥ng:', response.data);\n      return response.data;\n    } catch (error) {\n      var _error$response, _error$response2, _error$config;\n      console.error('‚ùå L·ªói khi t·∫°o ƒë∆°n h√†ng:', error);\n      console.error('üìå Chi ti·∫øt l·ªói:', {\n        status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status,\n        data: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data,\n        endpoint: (_error$config = error.config) === null || _error$config === void 0 ? void 0 : _error$config.url\n      });\n      throw error;\n    }\n  },\n  // L·∫•y s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè h√†ng\n  getCartCount: async email => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      return cart.products.reduce((total, item) => total + (item.quantity || 1), 0);\n    } catch (error) {\n      console.error('‚ùå L·ªói khi l·∫•y s·ªë l∆∞·ª£ng gi·ªè h√†ng:', error);\n      return 0;\n    }\n  },\n  // Ho·∫∑c n·∫øu b·∫°n mu·ªën t√≠nh t·ª´ localStorage cho nhanh\n  getCartCountFromStorage: () => {\n    try {\n      const cart = JSON.parse(localStorage.getItem('cart') || '{}');\n      if (!cart.products) return 0;\n      return cart.products.reduce((total, item) => total + (item.quantity || 1), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n  // T√≠nh t·ªïng ti·ªÅn - FIXED\n  calculateTotal: cartItems => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      // ∆Øu ti√™n specialPrice n·∫øu c√≥, n·∫øu kh√¥ng th√¨ d√πng price\n      const price = item.specialPrice !== undefined && item.specialPrice !== null ? item.specialPrice : item.price || 0;\n      const quantity = item.quantity || 1;\n      return total + price * quantity;\n    }, 0);\n  }\n};\nexport default cartService;","map":{"version":3,"names":["api","cartService","createCart","email","response","post","data","error","console","getActiveCart","get","addToCart","cartId","productId","quantity","updateQuantity","put","removeFromCart","delete","createOrder","paymentMethod","log","_error$response","_error$response2","_error$config","status","endpoint","config","url","getCartCount","cart","products","reduce","total","item","getCartCountFromStorage","JSON","parse","localStorage","getItem","calculateTotal","cartItems","length","price","specialPrice","undefined"],"sources":["D:/JVA/frontend/src/services/cartService.js"],"sourcesContent":["// services/cartService.js\nimport api from './api';\n\nconst cartService = {\n  // T·∫°o gi·ªè h√†ng m·ªõi\n  createCart: async (email) => {\n    try {\n      const response = await api.post(`/public/users/${email}/carts`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi t·∫°o gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n\n  // L·∫•y gi·ªè h√†ng active\n  getActiveCart: async (email) => {\n    try {\n      const response = await api.get(`/public/users/${email}/carts/active`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi l·∫•y gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n\n  // Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng\n  addToCart: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.post(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi th√™m v√†o gi·ªè h√†ng:', error);\n      throw error;\n    }\n  },\n\n  // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng\n  updateQuantity: async (cartId, productId, quantity) => {\n    try {\n      const response = await api.put(`/public/carts/${cartId}/products/${productId}/quantity/${quantity}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng:', error);\n      throw error;\n    }\n  },\n\n  // X√≥a s·∫£n ph·∫©m\n  removeFromCart: async (cartId, productId) => {\n    try {\n      const response = await api.delete(`/public/carts/${cartId}/products/${productId}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi x√≥a s·∫£n ph·∫©m:', error);\n      throw error;\n    }\n  },\n\n  // T·∫°o ƒë∆°n h√†ng - FIXED\n  createOrder: async (email, cartId, paymentMethod) => {\n    try {\n      console.log('üí∞ T·∫°o ƒë∆°n h√†ng v·ªõi:', { email, cartId, paymentMethod });\n      \n      // S·ª≠a endpoint theo ƒë√∫ng API c·ªßa b·∫°n\n      const response = await api.post(\n        `/public/user=${email}/carts/${cartId}/payments/${paymentMethod}/order`\n      );\n      \n      console.log('‚úÖ ƒê∆°n h√†ng t·∫°o th√†nh c√¥ng:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå L·ªói khi t·∫°o ƒë∆°n h√†ng:', error);\n      console.error('üìå Chi ti·∫øt l·ªói:', {\n        status: error.response?.status,\n        data: error.response?.data,\n        endpoint: error.config?.url\n      });\n      throw error;\n    }\n  },\n  \n  // L·∫•y s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè h√†ng\n  getCartCount: async (email) => {\n    try {\n      const cart = await cartService.getActiveCart(email);\n      if (!cart || !cart.products) return 0;\n      return cart.products.reduce((total, item) => total + (item.quantity || 1), 0);\n    } catch (error) {\n      console.error('‚ùå L·ªói khi l·∫•y s·ªë l∆∞·ª£ng gi·ªè h√†ng:', error);\n      return 0;\n    }\n  },\n\n  // Ho·∫∑c n·∫øu b·∫°n mu·ªën t√≠nh t·ª´ localStorage cho nhanh\n  getCartCountFromStorage: () => {\n    try {\n      const cart = JSON.parse(localStorage.getItem('cart') || '{}');\n      if (!cart.products) return 0;\n      return cart.products.reduce((total, item) => total + (item.quantity || 1), 0);\n    } catch (error) {\n      return 0;\n    }\n  },\n\n // T√≠nh t·ªïng ti·ªÅn - FIXED\n  calculateTotal: (cartItems) => {\n    if (!cartItems || cartItems.length === 0) return 0;\n    return cartItems.reduce((total, item) => {\n      // ∆Øu ti√™n specialPrice n·∫øu c√≥, n·∫øu kh√¥ng th√¨ d√πng price\n      const price = item.specialPrice !== undefined && item.specialPrice !== null \n        ? item.specialPrice \n        : item.price || 0;\n      const quantity = item.quantity || 1;\n      return total + (price * quantity);\n    }, 0);\n  }\n}\n\n\n\nexport default cartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}